# fe-optimize-practice

항해플러스 FE 3기 7팀 류시명

## 프론트엔드 배포 파이프라인

### 개요

<img width="625" alt="스크린샷 2024-11-20 11 46 34" src="https://github.com/user-attachments/assets/c9ecd8d8-ab9f-4c9b-af01-76ff1e509810">

1. 저장소 체크아웃
2. Node.js 18.x 버전 설정
3. origin master 브랜치에 push
4. 프로젝트 의존성 설치
5. Next.js 프로젝트 빌드
6. AWS 자격 증명 구성
7. 빌드된 파일 S3 버킷에 동기화(out 디렉토리 내 모든 파일)
8. CloudFront 캐시를 무효화

### 주요 링크

- S3 버킷 웹사이트 엔드포인트: http://hanghaeplus-optimize-fe.s3-website-ap-southeast-1.amazonaws.com/
- CloudFrount 배포 도메인 이름: d2iuoptgpn1j56.cloudfront.net

### 주요 개념

- GitHub Actions과 CI/CD 도구:
  - GitHub Actions는 빌드, 테스트 및 배포 파이프라인을 자동화할 수 있는 CI/CD 플랫폼
  - CI?
    - Continuous Integration. 지속적 통합. 새로운 코드가 주기적으로 빌드 및 테스트를 거쳐 레포지토리에 통합하는 과정을 지속하는 것
  - CD?
    - Continuous Delivery. 지속적 제공. CI를 통해 build, test를 거쳐 사용자에게 제공될 준비를 마친 코드를 배포하는 과정을 지속하는 것
  - CICD의 유의점?
    - 지속적인 통합과 배포를 사람이 일일이 하는 것은 매우 어렵다 -> 자동화 툴을 이용해 자동화한다.
    - 자동화를 통해 통합과 배포가 쉬워진 만큼 좋지 않은 코드가 통합, 배포되기도 쉽다 -> 테스트 코드, 코드 리뷰 등을 통해 CICD 전이나 과정 중 코드를 검증한다.
- S3와 스토리지
  - 애플리케이션을 운용하는 데 있어 필요한 데이터를 저장하는 곳.
  - 온프레미스로 실제 서버에 저장을 해도 되지만 비용이 만만치 않음
    - 필요한 데이터보다 너무 큰 서버를 구매했다? -> 낭비
    - 구비한 서버보다 훨씬 더 많은 데이터가 필요해졌다? -> 서버 증설 어려움
    - 서버를 비치할 공간 등의 제약 존재
  - 클라우드 서비스를 통해 사용한 만큼만 비용을 내고 필요한 데이터를 적재하면 매우 공간 및 비용적으로 효율적인 데이터 활용을 할 수 있음
  - AWS의 클라우드 서비스는 S3이고 매우 대중적인 스토리지 서비스
- CloudFront와 CDN
  - CDN(Contents Delivery Network)은 상호연결된 분산 서버 네트워크.
  - 사용자가 애플리케이션의 서버와 멀리 떨어져 있는 경우 대용량 파일을 로드하는 데 시간이 오래 걸림 -> 대용량 콘텐츠를 여러 CDN 서버에 캐싱하고, 지리적으로 사용자와 가까운 CDN을 연결시켜 사용자 컴퓨터에 훨씬 빨리 도달
  - CDN의 주 목적은 대기 시간을 줄이거나 네트워크 설계로 인해 발생하는 통신 지연을 줄이는 것. CDN은 클라이언트와 웹 사이트 서버 간에 중간 서버를 두어 효율성을 높여 애플리케이션의 사용자 환경을 개선.
  - CDN을 통한 요청의 순서
    - 최초 요청은 서버로부터 컨텐츠를 가져와 고객에게 전송하며 동시에 CDN 캐싱장비에 저장
    - 최초 요청 이후로의 요청은 CDN 에서 지정하는 해당 컨텐츠 만료 시점까지 캐싱된 컨텐츠를 전송
    - 자주 사용하는 페이지에 한해서 캐싱되며, 해당 컨텐츠 호출이 없을 경우 주기적으로 삭제
    - 서버가 파일을 찾는데 실패하는 경우 CDN 플랫폼의 다른 서버에서 컨텐츠를 찾은다음 엔드유저에게 응답을 전송
    - 컨텐츠를 사용할 수 없거나 오래된 경우 CDN은 향후 요청에 대해 응답할 수 있도록 새로운 컨텐츠를 저장
- 캐시 무효화(Cache Invalidation)
  - 콘텐츠 및 사이트가 업데이트 되었는데, CDN은 예전 데이터의 캐시를 갖고 있다면 사용자는 새로운 콘텐츠에 접근할 수 없음
  - 업데이트가 있으면 CDN에 저장된 캐시를 무효화시키고 새로운 콘텐츠에 대한 캐싱을 진행해야 함
- Repository secret과 환경변수
  - 환경변수는 주로 API Key, 비밀번호 등 보안에 민감한 정보들이다. 이걸 소스코드에 직접 넣어 저장소에 업로드해서는 안되기에 `.env` 파일 등을 이용해 환경변수를 관리했다.
  - 하지만 `.env` 파일 또한 `.gitignore`에 포함해야 하는 정보이기에 팀 내에 해당 파일을 공유하거나 폐기하는 것이 까다롭다.
  - 이런 점을 쉽게 처리할 수 있게 해주는 것이 Github Actions의 Repository secret

### 성능 최적화 보고서

#### CDN 연결 전(S3 버킷 웹사이트 엔드포인트로 접근)

<img width="698" alt="스크린샷 2024-11-20 14 48 07" src="https://github.com/user-attachments/assets/f8932d45-b14c-472f-97b7-3228ff115315">

#### CDN 연결 후(CloudFrount 배포 도메인으로 접근)

<img width="695" alt="스크린샷 2024-11-20 14 48 14" src="https://github.com/user-attachments/assets/73061673-4b74-4c92-ac5d-0c246e624c40">

- CDN을 통해 캐싱된 소스코드를 가져오기 때문에 HTML 및 이미지 파일 다운로드가 매우 빨라진 것을 확인할 수 있다.
